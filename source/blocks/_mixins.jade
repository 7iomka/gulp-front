//-//////////////////////////////////////////////////////////
//- BEM FORMS
//-//////////////////////////////////////////////////////////

//- Universal interface for all form elements
//- Example of use
//- +input(type="select", value=['value 1', 'value 2', value='n...'], name="sample-select", errors=['error 1', 'error 2'])
//- more seу in _forms.jade
//- @type enum — text, file, textarea, select, multiselect, radio, checkbox, captcha, date
//- @name string
//- @id string
//- @label string
//- @image string — Path to captcha image
//- @value string or array — array for select and multiselect
//- @placeholder string
//- @hint string — hint for input
//- @errors array — array of errors
//- @checked boolean — checked flag for radio and checkbox
//- @disabled boolean — disabled flag for radio and checkbox
//- @required boolean — show or hide required marker
//- @itemclass string — Class for form item

mixin input()
	- var type          = attributes.type           || "text"
	- var name          = attributes.name
	- var labeltext     = attributes.label
	- var value         = attributes.value
	- var placeholder   = attributes.placeholder
	- var hint          = attributes.hint
	- var errors        = attributes.errors
	- var id            = attributes.id
	- var image         = attributes.image          || "img/content/captcha.png"
	- var checked       = attributes.checked        || false
	- var disabled      = attributes.disabled       || false
	- var required      = attributes.required       || false
	- var itemclass     = attributes.class
	- var errorclass    ='b-form__item_error'
	- var requiredclass ='b-form__item_required'

	if (type == "text")
		+_input(name, labeltext, value, placeholder, itemclass, required, hint, errors)

	else if (type == "password")
		+_password(name, labeltext, value, placeholder, itemclass, required, hint, errors)
	
	else if (type == "file")
		+_file(name, labeltext, value, placeholder, itemclass, required, hint, errors)
	
	else if (type == "textarea")
		+_textarea(name, labeltext, value, placeholder, itemclass, required, hint, errors)

	else if (type == "select")
		+_select(name, labeltext, value, hint, itemclass, required, errors)
		
	else if (type == "multiselect")
		+_multiselect(name, labeltext, value, size, itemclass, required, hint, errors)

	else if (type == "radio")
		+_radio(name, id, labeltext, itemclass, required, checked, disabled)

	else if (type == "checkbox")
		+_checkbox(name, id, labeltext, itemclass, required, checked, disabled)
		
	else if (type == "captcha")
		+_captcha(name, labeltext, itemclass, required, image)

	else if (type == "date")
		+_date(name, label, value, placeholder, icon, itemclass, required, hint, errors)


//-//////////////////////////////////////////////////////////
//- BEM form service mixins
//-//////////////////////////////////////////////////////////
mixin __label(labeltext, name, required)
	if (labeltext)
		label(for=name).b-form__label!= labeltext
			if (required)
				span.b-form__label_required  *


mixin __errors(errors)
	if (errors)
		ul.b-form__errors
			each errorsent, errorsnum in errors
				li= errorsent


mixin __hint(hint)
	if (hint)
		.b-form__hint= hint


mixin __helpers(hint, errors)
	if (errors || hint)
		.b-form__helpers
			+__hint(hint)
			+__errors(errors)


mixin __wrapper(type, name, labeltext, value, placeholder, itemclass, required, hint, errors)
	if (errors)
		-var errorclass='b-form__item_error'

	if (required)
		-var requiredclass='b-form__item_required'

	if (itemclass)
		-var requiredclass=itemclass

	.b-form__item(class=errorclass, class="b-form__item_#{type}", class=requiredclass, class=itemclass)
		+__label(labeltext, name, required)

		.b-form__input
			block

		+__helpers(hint, errors)

		.clear



//-//////////////////////////////////////////////////////////
//- BEM form mixins
//-//////////////////////////////////////////////////////////
mixin _input(name, labeltext, value, placeholder, itemclass, required, hint, errors)
	+__wrapper('text', name, labeltext, value, placeholder, itemclass, required, hint, errors)
		input(type="text", value=value, name=name, placeholder=placeholder, id=name)


mixin _password(name, labeltext, value, placeholder, itemclass, required, hint, errors)
	+__wrapper('password', name, labeltext, value, placeholder, itemclass, required, hint, errors)
		input(type="password", value=value, name=name, placeholder=placeholder, id=name)


mixin _file(name, labeltext, value, placeholder, itemclass, required, hint, errors)
	+__wrapper('file', name, labeltext, value, placeholder, itemclass, required, hint, errors)
		input(type="file", value=value, name=name, placeholder=placeholder, id=name)


mixin _textarea(name, labeltext, value, placeholder, itemclass, required, hint, errors)
	+__wrapper('textarea', name, labeltext, value, placeholder, itemclass, required, hint, errors)
		textarea(name=name, cols="80", rows="24", placeholder=placeholder, id=name)= value


mixin _select(name, labeltext, value, placeholder, itemclass, required, hint, errors)
	+__wrapper('select', name, labeltext, value, placeholder, itemclass, required, hint, errors)
		select(name=name, id=name)
			each selectent, selectnum  in value
				option(value=selectnum, label=selectent)= selectent


mixin _multiselect(name, labeltext, value, size, itemclass, required, hint, errors)
	+__wrapper('multiselect', name, labeltext, value, placeholder, itemclass, required, hint, errors)
		select(name=name, id=name, multiple="multiple", size=size)
			each selectent, selectnum  in value
				option(value=selectnum, label=selectent)= selectent


mixin _date(name, label, value, placeholder, icon, itemclass, required, hint, errors)
	+__wrapper('input-date', name, labeltext, value, placeholder, itemclass, required, hint, errors)
		input(type="text", value=value, name=name, placeholder=placeholder, id=name)
		.b-form__input-icon.js-datepicker-trigger(class=icon)


mixin _radio(name, id, labeltext, itemclass, required, checked, disabled)
	.b-form__item.b-form__item_radio
		if (checked)
			if (disabled)
				input(type="radio", name=name, id=id, value=id, checked=true, disabled=true)
			else
				input(type="radio", name=name, id=id, value=id, checked=true, disabled=false)
		else
			if (disabled)
				input(type="radio", name=name, id=id, value=id, checked=false, disabled=true)
			else
				input(type="radio", name=name, id=id, value=id, checked=false, disabled=false)

		label(for="#{id}").b-form__label!= labeltext
		.clear


mixin _checkbox(name, id, labeltext, itemclass, required, checked, disabled)
	.b-form__item.b-form__item_checkbox
		if (checked)
			if (disabled)
				input(type="checkbox", name=name, id=id, value=id, checked=true, disabled=true)
			else
				input(type="checkbox", name=name, id=id, value=id, checked=true, disabled=false)
		else
			if (disabled)
				input(type="checkbox", name=name, id=id, value=id, checked=false, disabled=true)
			else
				input(type="checkbox", name=name, id=id, value=id, checked=false, disabled=false)
		if (labeltext)
			label(for="#{id}").b-form__label!= labeltext
		.clear


mixin _captcha(name, labeltext, itemclass, required, image)
	if (errors)
		-var errorclass='b-form_error'

	.b-form__item.b-form_captcha(class=errorclass)
		if (labeltext)
			label(for="#{name}").b-form__label!= labeltext
				span.b-form__label_required  *
		.b-form__input-image
			a(href="#", title="Дайте другой код!")
					img(src=image, alt="Секретный код!")

		.b-form__input
			input(type="text", name=name, id=name, value="")


		+__helpers(hint, errors)

		.clear



//-//////////////////////////////////////////////////////////
//- Other form elements
//-//////////////////////////////////////////////////////////

mixin inputGroup(labeltext)
	.b-input-group
		if (labeltext)
			label.b-input-group__label!= labeltext

		fieldset.b-input-group__body
			block
		.clear



//-//////////////////////////////////////////////////////////
//- Other mixins
//-//////////////////////////////////////////////////////////


mixin ie(condition)
	| 
	| <!--[!{condition}]>
	block
	| 
	| <![endif]-->
	| 

mixin iePlus(condition)
	| 
	| <!--[!{condition}]><!-->
	block
	| 
	| <!--<![endif]-->
	| 
